<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ“§í”„ë¡œëª¨ì…˜ ë©”ì¼ íšŒì‹  í…œí”Œë¦¿</title>
    <style>
        /* Gmail ë¶™ì—¬ë„£ê¸° ìµœì í™” ìŠ¤íƒ€ì¼ */
        body { font-family: "Malgun Gothic", "Nanum Gothic", "Pretendard", "Noto Sans KR", sans-serif; font-size: 1em; background-color: #f6f7fb; margin: 0; padding: 30px; }
        .container { background: #fff; border-radius: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); padding: 30px; max-width: 700px; margin: 0 auto; }
        h1 { text-align: center; font-size: 1.8em; margin-bottom: 25px; }
        label { font-weight: 600; margin-top: 15px; display: block; }
        select, input, textarea { width: 100%; margin-top: 6px; margin-bottom: 15px; padding: 10px; font-size: 1em; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        textarea { height: 200px; resize: none; }
        /* ë³µì‚¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #copyButton { width: 100%; padding: 12px; font-size: 1.1em; font-weight: 700; color: #fff; background-color: #007bff; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; transition: background-color 0.3s ease; }
        #copyButton:hover { background-color: #0056b3; }
        /* ê´€ë¦¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #manageButton { width: 100%; padding: 10px; font-size: 1em; color: #007bff; background-color: #e9f5ff; border: 1px solid #007bff; border-radius: 8px; cursor: pointer; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“§ ë©”ì¼ íšŒì‹  í…œí”Œë¦¿ ìë™ ì™„ì„±ê¸°</h1>
        
        <button id="manageButton" onclick="openManager()">âš™ï¸ í…œí”Œë¦¿ ê´€ë¦¬ ì°½ ì—´ê¸°</button>

        <label>ë©”ì¼ ì¹´í…Œê³ ë¦¬ ì„ íƒ</label>
        <select id="category">
            </select>

        <label>ë°›ëŠ” ë¶„ ì„±í•¨</label>
        <input type="text" id="name" placeholder="ì˜ˆ: ê¹€ì€ì •" />

        <label>ì‘í’ˆëª…</label>
        <input type="text" id="title" placeholder="ì˜ˆ: &lt;ì‚¬ë‘ ì•ˆ í•´&gt;" />

        <label>ì»¨íŒ ìš”ì²­ì¼</label>
        <input type="text" id="date" placeholder="ì˜ˆ: 10ì›” 25ì¼" />

        <label>ìë™ ìƒì„±ëœ ë©”ì¼ ë¬¸ì•ˆ</label>
        <textarea id="output" placeholder="ì„ íƒ ë° ì…ë ¥ í›„ ìë™ìœ¼ë¡œ ë¬¸ì•ˆì´ í‘œì‹œë©ë‹ˆë‹¤."></textarea>
        
        <button id="copyButton" onclick="copyText()">ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬</button>
    </div>

    <script>
        const category = document.getElementById("category");
        const name = document.getElementById("name");
        const title = document.getElementById("title");
        const date = document.getElementById("date");
        const output = document.getElementById("output");
        const copyButton = document.getElementById("copyButton");
        const storageKey = 'emailTemplates';
        const signature = "ìœ ì†Œì • ë“œë¦¼"; 
        
        // í…œí”Œë¦¿ ê¸°ë³¸ê°’ (Local Storageì— ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì‚¬ìš©)
        const DEFAULT_TEMPLATES = {
            "sns": { name: "â‘  SNS í¬ìŠ¤íŒ… ì»¨íŒ ìš”ì²­", text: "{n}ë‹˜ ì•ˆë…•í•˜ì„¸ìš”.\\nì¹´ì¹´ì˜¤ì—”í„°í…Œì¸ë¨¼íŠ¸ ìœ ì†Œì •ì…ë‹ˆë‹¤.\\n\\nê·€ì‚¬ {t} ì‘í’ˆì˜ íƒ€íŒŒìŠ¤ SNS í¬ìŠ¤íŒ…ì„ í¬ë§í•˜ì—¬ ì—°ë½ë“œë¦½ë‹ˆë‹¤.\\nìƒì„¸ ë‚´ìš©ì€ ì•„ë˜ í‘œë¥¼ í†µí•´ í™•ì¸ ë¶€íƒë“œë¦¬ë©°,\\nê´€ë ¨í•˜ì—¬ ê¶ê¸ˆí•˜ì‹  ì‚¬í•­ì€ ì–¸ì œë“  í¸íˆ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.\\n\\n{d}\\n\\nê°ì‚¬í•©ë‹ˆë‹¤.\\n{signature}" },
            "discount": { name: "â‘¡ í• ì¸ì´ë²¤íŠ¸ ì»¨íŒ ìš”ì²­", text: "{n}ë‹˜ ì•ˆë…•í•˜ì„¸ìš”,\\nì¹´ì¹´ì˜¤ì—”í„°í…Œì¸ë¨¼íŠ¸ ìœ ì†Œì •ì…ë‹ˆë‹¤.\\n\\níƒ€íŒŒìŠ¤ì—ì„œ ë‹¤ê°€ì˜¤ëŠ” <00ì›” ì§„í–‰ ì˜ˆì •ì¸> í• ì¸ì´ë²¤íŠ¸ì—\\nê·€ì‚¬ {t} ì‘í’ˆì˜ ì°¸ì—¬ë¥¼ ì œì•ˆë“œë¦¬ê³ ì ì—°ë½ë“œë¦½ë‹ˆë‹¤.\\nìƒì„¸ ë‚´ìš©ì€ ì•„ë˜ í‘œë¥¼ í†µí•´ í™•ì¸ ë¶€íƒë“œë¦¬ë©°,\\nê´€ë ¨í•˜ì—¬ ê¶ê¸ˆí•˜ì‹  ì‚¬í•­ì€ ì–¸ì œë“  í¸íˆ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.\\n\\n{d}\\n\\nê°ì‚¬í•©ë‹ˆë‹¤.\\n{signature}" },
            "viewing": { name: "â‘¢ ì—´ëŒì´ë²¤íŠ¸ ì—ì…‹ ì»¨íŒ ìš”ì²­", text: "{n}ë‹˜ ì•ˆë…•í•˜ì„¸ìš”,\\nì¹´ì¹´ì˜¤ì—”í„°í…Œì¸ë¨¼íŠ¸ ìœ ì†Œì •ì…ë‹ˆë‹¤.\\n\\nê·€ì‚¬ {t} ì‘í’ˆì˜ íƒ€íŒŒìŠ¤ ì—´ëŒì´ë²¤íŠ¸ ì§„í–‰ì„ í¬ë§í•˜ì—¬ ì—°ë½ë“œë¦½ë‹ˆë‹¤.\\nì•„ë˜ í‘œì™€ ì²¨ë¶€íŒŒì¼ì„ í†µí•´ ìƒì„¸ ë‚´ìš©ê³¼ ì´ë²¤íŠ¸ ì—ì…‹ ì „ë‹¬ë“œë¦¬ì˜¤ë‹ˆ í™•ì¸ì„ ë¶€íƒë“œë¦¬ë©°,\\nê²€í†  ê³¼ì •ì—ì„œ ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  í¸íˆ ì—°ë½ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.\\n\\n{d}\\n\\nê°ì‚¬í•©ë‹ˆë‹¤.\\n{signature}" }
        };

        function loadTemplates() {
            let templates = JSON.parse(localStorage.getItem(storageKey));
            
            if (!templates) {
                templates = DEFAULT_TEMPLATES;
                localStorage.setItem(storageKey, JSON.stringify(templates));
            }
            
            // Select ì˜µì…˜ ì´ˆê¸°í™”
            const currentSelection = category.value; // í˜„ì¬ ì„ íƒ ê°’ì„ ì„ì‹œ ì €ì¥
            category.innerHTML = '<option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>';
            let firstTemplateKey = ''; // ì²« ë²ˆì§¸ í…œí”Œë¦¿ í‚¤ë¥¼ ì €ì¥í•  ë³€ìˆ˜

            for (const key in templates) {
                if (!firstTemplateKey) {
                    firstTemplateKey = key;
                }
                const option = document.createElement('option');
                option.value = key;
                option.textContent = templates[key].name;
                category.appendChild(option);
            }
            
            // ì˜µì…˜ ë¡œë“œ í›„, ì´ì „ì— ì„ íƒëœ ê°’ì´ ìˆë‹¤ë©´ ë³µì› ì‹œë„
            if (currentSelection && templates[currentSelection]) {
                category.value = currentSelection;
            } else if (firstTemplateKey) {
                // ì´ì „ì— ì„ íƒëœ ê°’ì´ ì—†ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ì²« ë²ˆì§¸ í…œí”Œë¦¿ì„ ìë™ìœ¼ë¡œ ì„ íƒ
                category.value = firstTemplateKey;
            } else {
                // í…œí”Œë¦¿ì´ ì•„ì˜ˆ ì—†ì„ ê²½ìš° '--ì„ íƒí•˜ì„¸ìš”--' ìœ ì§€
                category.value = "";
            }
            
            return templates;
        }
        
        function updateTemplate() {
            // í…œí”Œë¦¿ì„ ë¡œë“œí•˜ê³  ì„ íƒ ìƒíƒœë¥¼ ë³µì›/ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
            const templates = loadTemplates(); 
            const selectedTemplate = templates[category.value];
            
            const n = name.value || "ë‹´ë‹¹ì";
            const t = title.value || "<ì‘í’ˆëª…>";
            const d = date.value ? `*ì»¨íŒ ìš”ì²­ì¼ : ${date.value}` : "*ì»¨íŒ ìš”ì²­ì¼ :";

            let text = "ì„ íƒ ë° ì…ë ¥ í›„ ìë™ìœ¼ë¡œ ë¬¸ì•ˆì´ í‘œì‹œë©ë‹ˆë‹¤.";

            // í…œí”Œë¦¿ì´ ì„ íƒë˜ì—ˆê³ , ê·¸ í…œí”Œë¦¿ì˜ ë‚´ìš©(text) í•„ë“œê°€ ìœ íš¨í•œì§€ í™•ì¸
            if (category.value !== "" && selectedTemplate && selectedTemplate.text) { 
                
                let baseText = selectedTemplate.text;
                
                text = baseText.replace(/{n}/g, n)
                                 .replace(/{t}/g, t)
                                 .replace(/{d}/g, d)
                                 .replace(/{signature}/g, signature)
                                 .replace(/\\n/g, '\n'); 
            } else if (category.value !== "" && selectedTemplate && !selectedTemplate.text) {
                // ë””ë²„ê¹… ë©”ì‹œì§€: ì„ íƒì€ ë˜ì—ˆìœ¼ë‚˜ ë‚´ìš©(text) í•„ë“œê°€ ëˆ„ë½ë¨
                text = `[ì˜¤ë¥˜: í…œí”Œë¦¿ ë‚´ìš©(TEXT) ëˆ„ë½] - ì„ íƒëœ í‚¤: ${category.value}\ní…œí”Œë¦¿ ê´€ë¦¬ ì°½ì„ ì—´ì–´ í•´ë‹¹ í…œí”Œë¦¿ì˜ 'ë©”ì¼ ë¬¸ì•ˆ'ì„ í™•ì¸í•˜ê³  ì €ì¥í•´ì£¼ì„¸ìš”.`;
                // ì½˜ì†”ì— ì˜¤ë¥˜ ê¸°ë¡
                console.error(`ERROR: Missing 'text' property for template key: ${category.value}`);
            }
            
            output.value = text;
        }
        
        function openManager() {
            window.open('template_manager.html', 'TemplateManager', 'width=800,height=600,scrollbars=yes');
        }
        
        function copyText() {
            output.select();
            output.setSelectionRange(0, 99999);
            
            try {
                navigator.clipboard.writeText(output.value)
                    .then(() => {
                        copyButton.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
                        setTimeout(() => {
                            copyButton.textContent = 'ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬';
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                        alert('í…ìŠ¤íŠ¸ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
                    });
            } catch (err) {
                document.execCommand('copy');
                copyButton.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
                setTimeout(() => {
                    copyButton.textContent = 'ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬';
                }, 2000);
            }
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('focus', updateTemplate);
        category.addEventListener("change", updateTemplate);
        name.addEventListener("input", updateTemplate);
        title.addEventListener("input", updateTemplate);
        date.addEventListener("input", updateTemplate);
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ë¬¸ì•ˆ í‘œì‹œë¥¼ ê°•ì œ ì‹¤í–‰
        updateTemplate(); 
    </script>
</body>
</html>